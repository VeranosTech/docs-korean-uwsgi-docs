

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ko" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ko" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scaling SSL connections (uWSGI 1.9) &mdash; uWSGI 2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="색인" href="genindex.html" />
    <link rel="search" title="검색" href="search.html" />
    <link rel="next" title="Setting POSIX Capabilities" href="Capabilities.html" />
    <link rel="prev" title="Adding applications dynamically" href="DynamicApps.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> uWSGI
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="WSGIquickstart.html">Quickstart for Python/WSGI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="PSGIquickstart.html">Quickstart for perl/PSGI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="RackQuickstart.html">Quickstart for ruby/Rack applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="Snippets.html">Snippets</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Download.html">Getting uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Installing uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildSystem.html">The uWSGI build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="Management.html">Managing the uWSGI server</a></li>
<li class="toctree-l1"><a class="reference internal" href="LanguagesAndPlatforms.html">Supported languages and platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="SupportedPlatforms.html">Supported Platforms/Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebServers.html">Web server integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThingsToKnow.html">Things to know (best practices and &quot;issues&quot;) READ IT !!!</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">Configuring uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="FallbackConfig.html">Fallback configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigLogic.html">Configuration logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="Options.html">uWSGI Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="CustomOptions.html">Defining new options for your instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="ParsingOrder.html">How uWSGI parses config files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Vars.html">uwsgi protocol magic variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="Protocol.html">The uwsgi Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="AttachingDaemons.html">Managing external daemons/services</a></li>
<li class="toctree-l1"><a class="reference internal" href="MasterFIFO.html">The Master FIFO</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inetd.html">Socket activation with inetd/xinetd</a></li>
<li class="toctree-l1"><a class="reference internal" href="Upstart.html">Running uWSGI via Upstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="Systemd.html">Systemd</a></li>
<li class="toctree-l1"><a class="reference internal" href="Circus.html">Running uWSGI instances with Circus</a></li>
<li class="toctree-l1"><a class="reference internal" href="Embed.html">Embedding an application in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogFormat.html">Formatting uWSGI requests logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogEncoders.html">Log encoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hooks.html">Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="WorkerOverride.html">Overriding Workers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThirdPartyPlugins.html">uWSGI third party plugins</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/CachingCookbook.html">The uWSGI Caching Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/Django_and_nginx.html">Setting up Django and your web server with uWSGI and nginx</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/dreamhost.html">Running uWSGI on Dreamhost shared hosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/heroku_python.html">Running python webapps on Heroku with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/heroku_ruby.html">Running Ruby/Rack webapps on Heroku with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/ReliableFuse.html">Reliably use FUSE filesystems for uWSGI vassals (with Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/DynamicProxying.html">Build a dynamic proxy using RPC and internal routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/GraphiteAndMetrics.html">Setting up Graphite on Ubuntu using the Metrics subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="articles/SerializingAccept.html">Serializing accept(), AKA Thundering Herd, AKA the Zeeg Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/TheArtOfGracefulReloading.html">The Art of Graceful Reloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/FunWithPerlEyetoyRaspberrypi.html">Fun with Perl, Eyetoy and RaspberryPi</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/OffloadingWebsocketsAndSSE.html">Offloading Websockets and Server-Sent Events AKA &quot;Combine them with Django safely&quot;</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/WSGIEnvBehaviour.html">WSGI env behaviour policies</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AlarmSubsystem.html">The uWSGI alarm subsystem (from 1.3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Caching.html">The uWSGI caching framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebCaching.html">WebCaching framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cron.html">The uWSGI cron-like interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fastrouter.html">The uWSGI FastRouter</a></li>
<li class="toctree-l1"><a class="reference internal" href="InternalRouting.html">uWSGI internal routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Legion.html">The uWSGI Legion subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Locks.html">Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mules.html">uWSGI Mules</a></li>
<li class="toctree-l1"><a class="reference internal" href="OffloadSubsystem.html">The uWSGI offloading subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Queue.html">The uWSGI queue framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="RPC.html">uWSGI RPC Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="SharedArea.html">SharedArea -- share memory pages between uWSGI components</a></li>
<li class="toctree-l1"><a class="reference internal" href="Signals.html">The uWSGI Signal Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Spooler.html">The uWSGI Spooler</a></li>
<li class="toctree-l1"><a class="reference internal" href="SubscriptionServer.html">uWSGI Subscription Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="StaticFiles.html">Serving static files with uWSGI (updated to 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="SNI.html">SNI - Server Name Identification (virtual hosting for SSL nodes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeoIP.html">The GeoIP plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Transformations.html">uWSGI Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebSockets.html">WebSocket support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metrics.html">The Metrics subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chunked.html">The Chunked input API</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Cheaper.html">The uWSGI cheaper subsystem -- adaptive process spawning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emperor.html">The uWSGI Emperor -- multi-app deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="Broodlord.html">Auto-scaling with Broodlord mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="Zerg.html">Zerg mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicApps.html">Adding applications dynamically</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Scaling SSL connections (uWSGI 1.9)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup-1-using-the-uwsgi-cache-for-storing-ssl-sessions">Setup 1: using the uWSGI cache for storing SSL sessions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-2-synchronize-caches-of-different-https-routers">Setup 2: synchronize caches of different HTTPS routers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-named-caches">Using named caches</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Capabilities.html">Setting POSIX Capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cgroups.html">Running uWSGI in a Linux CGroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="KSM.html">Using Linux KSM in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Namespaces.html">Jailing your apps using Linux Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="Namespaces.html#the-old-way-the-namespace-option">The old way: the --namespace option</a></li>
<li class="toctree-l1"><a class="reference internal" href="FreeBSDJails.html">FreeBSD Jails</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkptyRouter.html">The Forkpty Router</a></li>
<li class="toctree-l1"><a class="reference internal" href="TunTapRouter.html">The TunTap Router</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Nagios.html">Monitoring uWSGI with Nagios</a></li>
<li class="toctree-l1"><a class="reference internal" href="SNMP.html">The embedded SNMP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="PushingStats.html">Pushing statistics (from 1.4)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Carbon.html">Integration with Graphite/Carbon</a></li>
<li class="toctree-l1"><a class="reference internal" href="StatsServer.html">The uWSGI Stats Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metrics.html">The Metrics subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Async.html">uWSGI asynchronous/non-blocking modes (updated to uWSGI 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gevent.html">The Gevent loop engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tornado.html">The Tornado loop engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="uGreen.html">uGreen -- uWSGI Green Threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio.html">The asyncio loop engine (CPython &gt;= 3.4, uWSGI &gt;= 2.0.4)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Apache.html">Apache support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cherokee.html">Cherokee support</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTTP.html">Native HTTP support</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTTPS.html">HTTPS 지원 (1.3 버전부터)</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPDY.html">The SPDY router (uWSGI 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lighttpd.html">Lighttpd support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mongrel2.html">Attaching uWSGI to Mongrel2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Nginx.html">Nginx support</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenBSDhttpd.html">Using OpenBSD httpd as proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenBSDhttpd.html#notes">Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Python.html">Python support</a></li>
<li class="toctree-l1"><a class="reference internal" href="PyPy.html">The PyPy plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="PHP.html">Running PHP scripts in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Perl.html">uWSGI Perl support (PSGI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ruby.html">Ruby support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lua.html">Using Lua/WSAPI with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="JVM.html">JVM in the uWSGI server (updated to 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mono.html">The Mono ASP.NET plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="CGI.html">Running CGI scripts on uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="GCCGO.html">The GCCGO plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Symcall.html">The Symcall plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="XSLT.html">The XSLT plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSI.html">SSI (Server Side Includes) plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="V8.html">uWSGI V8 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="GridFS.html">The GridFS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="GlusterFS.html">The GlusterFS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Rados.html">The RADOS plugin</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Pty.html">The Pty plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPNEGO.html">SPNEGO authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="LDAP.html">Configuring uWSGI with LDAP</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Erlang.html">Integrating uWSGI with Erlang</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagementFlag.html">Management Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="Go.html">uWSGI Go support (1.4 only)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.18.html">uWSGI 2.0.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.17.1.html">uWSGI 2.0.17.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.17.html">uWSGI 2.0.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.16.html">uWSGI 2.0.16</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.15.html">uWSGI 2.0.15</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.14.html">uWSGI 2.0.14</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.13.1.html">uWSGI 2.0.13.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.13.html">uWSGI 2.0.13</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.12.html">uWSGI 2.0.12</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.2.html">uWSGI 2.0.11.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.1.html">uWSGI 2.0.11.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.html">uWSGI 2.0.11</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.10.html">uWSGI 2.0.10</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.9.html">uWSGI 2.0.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.8.html">uWSGI 2.0.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.7.html">uWSGI 2.0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.6.html">uWSGI 2.0.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.5.html">uWSGI 2.0.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.4.html">uWSGI 2.0.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.3.html">uWSGI 2.0.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.2.html">uWSGI 2.0.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.1.html">uWSGI 2.0.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.html">uWSGI 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.21.html">uWSGI 1.9.21</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.20.html">uWSGI 1.9.20</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.19.html">uWSGI 1.9.19</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.18.html">uWSGI 1.9.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.17.html">uWSGI 1.9.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.16.html">uWSGI 1.9.16</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.15.html">uWSGI 1.9.15</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.14.html">uWSGI 1.9.14</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.13.html">uWSGI 1.9.13</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.12.html">uWSGI 1.9.12</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.11.html">uWSGI 1.9.11</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.10.html">uWSGI 1.9.10</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.9.html">uWSGI 1.9.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.8.html">uWSGI 1.9.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.7.html">uWSGI 1.9.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.6.html">uWSGI 1.9.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.5.html">uWSGI 1.9.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.4.html">uWSGI 1.9.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.3.html">uWSGI 1.9.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.2.html">uWSGI 1.9.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.1.html">uWSGI 1.9.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.html">uWSGI 1.9</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">uWSGI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Scaling SSL connections (uWSGI 1.9)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/SSLScaling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scaling-ssl-connections-uwsgi-1-9">
<h1>Scaling SSL connections (uWSGI 1.9)<a class="headerlink" href="#scaling-ssl-connections-uwsgi-1-9" title="제목 주소">¶</a></h1>
<p>Distributing SSL servers in a cluster is a hard topic. The biggest problem is sharing SSL sessions between different nodes.</p>
<p>The problem is amplified in non-blocking servers due to OpenSSL's limits in the way sessions are managed.</p>
<p>For example, you cannot share sessions in Memcached servers and access them in a non-blocking way.</p>
<p>A common solution (well, a compromise, maybe) until now has been to use a single SSL terminator balancing requests to multiple non-encrypted backends. This solution kinda works, but obviously it does not scale.</p>
<p>Starting from uWSGI 1.9-dev an implementation (based on the <em>stud</em> project) of distributed caching has been added.</p>
<div class="section" id="setup-1-using-the-uwsgi-cache-for-storing-ssl-sessions">
<h2>Setup 1: using the uWSGI cache for storing SSL sessions<a class="headerlink" href="#setup-1-using-the-uwsgi-cache-for-storing-ssl-sessions" title="제목 주소">¶</a></h2>
<p>You can configure the SSL subsystem of uWSGI to use the shared cache. The SSL sessions will time out according to the expiry value of the cache item. This way the cache sweeper thread (managed by the master) will destroy sessions in the cache.</p>
<div class="admonition important">
<p class="first admonition-title">중요</p>
<p class="last">The order of the options is important. <code class="docutils literal notranslate"><span class="pre">cache</span></code> options must be specified BEFORE <code class="docutils literal notranslate"><span class="pre">ssl-sessions-use-cache</span></code> and <code class="docutils literal notranslate"><span class="pre">https</span></code> options.</p>
</div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">; spawn the master process (it will run the cache sweeper thread)</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; store up to 20k sessions</span>
<span class="na">cache</span> <span class="o">=</span> <span class="s">20000</span>
<span class="c1">; 4k per object is enough for SSL sessions</span>
<span class="na">cache-blocksize</span> <span class="o">=</span> <span class="s">4096</span>
<span class="c1">; force the SSL subsystem to use the uWSGI cache as session storage</span>
<span class="na">ssl-sessions-use-cache</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; set SSL session timeout (in seconds)</span>
<span class="na">ssl-sessions-timeout</span> <span class="o">=</span> <span class="s">300</span>
<span class="c1">; set the session context string (see later)</span>
<span class="na">https-session-context</span> <span class="o">=</span> <span class="s">foobar</span>
<span class="c1">; spawn an HTTPS router</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">192.168.173.1:8443,foobar.crt,foobar.key</span>
<span class="c1">; spawn 8 processes for the HTTPS router (all sharing the same session cache)</span>
<span class="na">http-processes</span> <span class="o">=</span> <span class="s">8</span>
<span class="c1">; add a bunch of uwsgi nodes to relay traffic to</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.10:3031</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.11:3031</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.12:3031</span>
<span class="c1">; add stats</span>
<span class="na">stats</span> <span class="o">=</span> <span class="s">127.0.0.1:5001</span>
</pre></div>
</div>
<p>Now start blasting your HTTPS router and then telnet to port 5001. Under the &quot;cache&quot; object of the JSON
output you should see the values &quot;items&quot; and &quot;hits&quot; increasing. The value &quot;miss&quot; is increased every time a session is not found
in the cache. It is a good metric of the SSL performance users can expect.</p>
</div>
<div class="section" id="setup-2-synchronize-caches-of-different-https-routers">
<h2>Setup 2: synchronize caches of different HTTPS routers<a class="headerlink" href="#setup-2-synchronize-caches-of-different-https-routers" title="제목 주소">¶</a></h2>
<p>The objective is to synchronize each new session in each distributed cache. To accomplish that you have to spawn a special thread
(<code class="docutils literal notranslate"><span class="pre">cache-udp-server</span></code>) in each instance and list all of the remote servers that should be synchronized.</p>
<p>A pure-TCP load balancer (like HAProxy or uWSGI's Rawrouter) can be used to load balance between the various HTTPS routers.</p>
<p>Here's a possible Rawrouter config.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">rawrouter</span> <span class="o">=</span> <span class="s">192.168.173.99:443</span>
<span class="na">rawrouter-to</span> <span class="o">=</span> <span class="s">192.168.173.1:8443</span>
<span class="na">rawrouter-to</span> <span class="o">=</span> <span class="s">192.168.173.2:8443</span>
<span class="na">rawrouter-to</span> <span class="o">=</span> <span class="s">192.168.173.3:8443</span>
</pre></div>
</div>
<p>Now you can configure the first node (the new options are at the end of the .ini config)</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">; spawn the master process (it will run the cache sweeper thread)</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; store up to 20k sessions</span>
<span class="na">cache</span> <span class="o">=</span> <span class="s">20000</span>
<span class="c1">; 4k per object is enough for SSL sessions</span>
<span class="na">cache-blocksize</span> <span class="o">=</span> <span class="s">4096</span>
<span class="c1">; force the SSL subsystem to use the uWSGI cache as session storage</span>
<span class="na">ssl-sessions-use-cache</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; set SSL session timeout (in seconds)</span>
<span class="na">ssl-sessions-timeout</span> <span class="o">=</span> <span class="s">300</span>
<span class="c1">; set the session context string (see later)</span>
<span class="na">https-session-context</span> <span class="o">=</span> <span class="s">foobar</span>
<span class="c1">; spawn an HTTPS router</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">192.168.173.1:8443,foobar.crt,foobar.key</span>
<span class="c1">; spawn 8 processes for the HTTPS router (all sharing the same session cache)</span>
<span class="na">http-processes</span> <span class="o">=</span> <span class="s">8</span>
<span class="c1">; add a bunch of uwsgi nodes to relay traffic to</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.10:3031</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.11:3031</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.12:3031</span>
<span class="c1">; add stats</span>
<span class="na">stats</span> <span class="o">=</span> <span class="s">127.0.0.1:5001</span>

<span class="c1">; spawn the cache-udp-server</span>
<span class="na">cache-udp-server</span> <span class="o">=</span> <span class="s">192.168.173.1:7171</span>
<span class="c1">; propagate updates to the other nodes</span>
<span class="na">cache-udp-node</span> <span class="o">=</span> <span class="s">192.168.173.2:7171</span>
<span class="na">cache-udp-node</span> <span class="o">=</span> <span class="s">192.168.173.3:7171</span>
</pre></div>
</div>
<p>and the other two...</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">; spawn the master process (it will run the cache sweeper thread)</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; store up to 20k sessions</span>
<span class="na">cache</span> <span class="o">=</span> <span class="s">20000</span>
<span class="c1">; 4k per object is enough for SSL sessions</span>
<span class="na">cache-blocksize</span> <span class="o">=</span> <span class="s">4096</span>
<span class="c1">; force the SSL subsystem to use the uWSGI cache as session storage</span>
<span class="na">ssl-sessions-use-cache</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; set SSL session timeout (in seconds)</span>
<span class="na">ssl-sessions-timeout</span> <span class="o">=</span> <span class="s">300</span>
<span class="c1">; set the session context string (see later)</span>
<span class="na">https-session-context</span> <span class="o">=</span> <span class="s">foobar</span>
<span class="c1">; spawn an HTTPS router</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">192.168.173.1:8443,foobar.crt,foobar.key</span>
<span class="c1">; spawn 8 processes for the HTTPS router (all sharing the same session cache)</span>
<span class="na">http-processes</span> <span class="o">=</span> <span class="s">8</span>
<span class="c1">; add a bunch of uwsgi nodes to relay traffic to</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.10:3031</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.11:3031</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.12:3031</span>
<span class="c1">; add stats</span>
<span class="na">stats</span> <span class="o">=</span> <span class="s">127.0.0.1:5001</span>

<span class="c1">; spawn the cache-udp-server</span>
<span class="na">cache-udp-server</span> <span class="o">=</span> <span class="s">192.168.173.2:7171</span>
<span class="c1">; propagate updates to the other nodes</span>
<span class="na">cache-udp-node</span> <span class="o">=</span> <span class="s">192.168.173.1:7171</span>
<span class="na">cache-udp-node</span> <span class="o">=</span> <span class="s">192.168.173.3:7171</span>
</pre></div>
</div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">; spawn the master process (it will run the cache sweeper thread)</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; store up to 20k sessions</span>
<span class="na">cache</span> <span class="o">=</span> <span class="s">20000</span>
<span class="c1">; 4k per object is enough for SSL sessions</span>
<span class="na">cache-blocksize</span> <span class="o">=</span> <span class="s">4096</span>
<span class="c1">; force the SSL subsystem to use the uWSGI cache as session storage</span>
<span class="na">ssl-sessions-use-cache</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; set SSL session timeout (in seconds)</span>
<span class="na">ssl-sessions-timeout</span> <span class="o">=</span> <span class="s">300</span>
<span class="c1">; set the session context string (see later)</span>
<span class="na">https-session-context</span> <span class="o">=</span> <span class="s">foobar</span>
<span class="c1">; spawn an HTTPS router</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">192.168.173.1:8443,foobar.crt,foobar.key</span>
<span class="c1">; spawn 8 processes for the HTTPS router (all sharing the same session cache)</span>
<span class="na">http-processes</span> <span class="o">=</span> <span class="s">8</span>
<span class="c1">; add a bunch of uwsgi nodes to relay traffic to</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.10:3031</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.11:3031</span>
<span class="na">http-to</span> <span class="o">=</span> <span class="s">192.168.173.12:3031</span>
<span class="c1">; add stats</span>
<span class="na">stats</span> <span class="o">=</span> <span class="s">127.0.0.1:5001</span>

<span class="c1">; spawn the cache-udp-server</span>
<span class="na">cache-udp-server</span> <span class="o">=</span> <span class="s">192.168.173.3:7171</span>
<span class="c1">; propagate updates to the other nodes</span>
<span class="na">cache-udp-node</span> <span class="o">=</span> <span class="s">192.168.173.1:7171</span>
<span class="na">cache-udp-node</span> <span class="o">=</span> <span class="s">192.168.173.2:7171</span>
</pre></div>
</div>
<p>Start hammering the Rawrouter (remember to use a client supporting persistent SSL sessions, like your browser) and get cache statistics
from the stats server of each HTTPS terminator node. If the count of &quot;hits&quot; is a lot higher than the &quot;miss&quot; value the system is working well
and your load is distributed and in awesome hyper high performance mode.</p>
<p>So, what is <code class="docutils literal notranslate"><span class="pre">https-session-context</span></code>, you ask? Basically each SSL session before being used is checked against a fixed string (the session context). If the session does not match that string, it is rejected. By default the session context is initialized to a value built from the HTTP server address. Forcing it to a shared value will avoid a session created in a node being rejected in another one.</p>
</div>
<div class="section" id="using-named-caches">
<h2>Using named caches<a class="headerlink" href="#using-named-caches" title="제목 주소">¶</a></h2>
<p>Starting from uWSGI 1.9 you can have multiple caches. This is a setup with 2 nodes using a new generation cache named &quot;ssl&quot;.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cache2</span></code> option allows also to set a custom key size. Since SSL session keys are not very long, we can use it to optimize memory usage. In this example we use 128 byte key size limit, which should be enough for session IDs.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">; spawn the master process (it will run the cache sweeper thread)</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; store up to 20k sessions</span>
<span class="na">cache2</span> <span class="o">=</span> <span class="s">name=ssl,items=20000,keysize=128,blocksize=4096,node=127.0.0.1:4242,udp=127.0.0.1:4141</span>
<span class="c1">; force the SSL subsystem to use the uWSGI cache as session storage</span>
<span class="na">ssl-sessions-use-cache</span> <span class="o">=</span> <span class="s">ssl</span>
<span class="c1">; set sessions timeout (in seconds)</span>
<span class="na">ssl-sessions-timeout</span> <span class="o">=</span> <span class="s">300</span>
<span class="c1">; set the session context string</span>
<span class="na">https-session-context</span> <span class="o">=</span> <span class="s">foobar</span>
<span class="c1">; spawn an HTTPS router</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">:8443,foobar.crt,foobar.key</span>
<span class="c1">; spawn 8 processes for the HTTPS router (all sharing the same session cache)</span>
<span class="na">http-processes</span> <span class="o">=</span> <span class="s">8</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">werkzeug.testapp:test_app</span>
<span class="c1">; add stats</span>
<span class="na">stats</span> <span class="o">=</span> <span class="s">:5001</span>
</pre></div>
</div>
<p>and the second node...</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">; spawn the master process (it will run the cache sweeper thread)</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; store up to 20k sessions</span>
<span class="na">cache2</span> <span class="o">=</span> <span class="s">name=ssl,items=20000,blocksize=4096,node=127.0.0.1:4141,udp=127.0.0.1:4242</span>
<span class="c1">; force the SSL subsystem to use the uWSGI cache as session storage</span>
<span class="na">ssl-sessions-use-cache</span> <span class="o">=</span> <span class="s">ssl</span>
<span class="c1">; set session timeout</span>
<span class="na">ssl-sessions-timeout</span> <span class="o">=</span> <span class="s">300</span>
<span class="c1">; set the session context string</span>
<span class="na">https-session-context</span> <span class="o">=</span> <span class="s">foobar</span>
<span class="c1">; spawn an HTTPS router</span>
<span class="na">https</span> <span class="o">=</span> <span class="s">:8444,foobar.crt,foobar.key</span>
<span class="c1">; spawn 8 processes for the HTTPS router (all sharing the same sessions cache)</span>
<span class="na">http-processes</span> <span class="o">=</span> <span class="s">8</span>
<span class="na">module</span> <span class="o">=</span> <span class="s">werkzeug.testapp:test_app</span>
<span class="c1">; add stats</span>
<span class="na">stats</span> <span class="o">=</span> <span class="s">:5002</span>
</pre></div>
</div>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="제목 주소">¶</a></h2>
<p>If you do not want to manually configure the cache UDP nodes and your network configuration supports it, you can use UDP multicast.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">...</span>
<span class="na">cache-udp-server</span> <span class="o">=</span> <span class="s">225.1.1.1:7171</span>
<span class="na">cache-udp-node</span> <span class="o">=</span> <span class="s">225.1.1.1:7171</span>
</pre></div>
</div>
<ul class="simple">
<li>A new gateway server is in development, named &quot;udprepeater&quot;. It will basically forward all of UDP packets it receives to the subscribed back-end nodes. It will allow you to maintain the zero-config style of the subscription system (basically you only need to configure a single cache UDP node pointing to the repeater).</li>
<li>Currently there is no security between the cache nodes. For some users this may be a huge problem, so a security mode (encrypting the packets) is in development.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Capabilities.html" class="btn btn-neutral float-right" title="Setting POSIX Capabilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="DynamicApps.html" class="btn btn-neutral" title="Adding applications dynamically" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2016, uWSGI.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0',
            LANGUAGE:'ko',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>