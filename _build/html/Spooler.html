

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ko" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ko" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The uWSGI Spooler &mdash; uWSGI 2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="색인" href="genindex.html" />
    <link rel="search" title="검색" href="search.html" />
    <link rel="next" title="uWSGI Subscription Server" href="SubscriptionServer.html" />
    <link rel="prev" title="The uWSGI Signal Framework" href="Signals.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> uWSGI
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="WSGIquickstart.html">Quickstart for Python/WSGI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="PSGIquickstart.html">Quickstart for perl/PSGI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="RackQuickstart.html">Quickstart for ruby/Rack applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="Snippets.html">Snippets</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Download.html">Getting uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Installing uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildSystem.html">The uWSGI build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="Management.html">Managing the uWSGI server</a></li>
<li class="toctree-l1"><a class="reference internal" href="LanguagesAndPlatforms.html">Supported languages and platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="SupportedPlatforms.html">Supported Platforms/Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebServers.html">Web server integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThingsToKnow.html">Things to know (best practices and &quot;issues&quot;) READ IT !!!</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">Configuring uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="FallbackConfig.html">Fallback configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigLogic.html">Configuration logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="Options.html">uWSGI Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="CustomOptions.html">Defining new options for your instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="ParsingOrder.html">How uWSGI parses config files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Vars.html">uwsgi protocol magic variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="Protocol.html">The uwsgi Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="AttachingDaemons.html">Managing external daemons/services</a></li>
<li class="toctree-l1"><a class="reference internal" href="MasterFIFO.html">The Master FIFO</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inetd.html">Socket activation with inetd/xinetd</a></li>
<li class="toctree-l1"><a class="reference internal" href="Upstart.html">Running uWSGI via Upstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="Systemd.html">Systemd</a></li>
<li class="toctree-l1"><a class="reference internal" href="Circus.html">Running uWSGI instances with Circus</a></li>
<li class="toctree-l1"><a class="reference internal" href="Embed.html">Embedding an application in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogFormat.html">Formatting uWSGI requests logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogEncoders.html">Log encoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hooks.html">Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="WorkerOverride.html">Overriding Workers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThirdPartyPlugins.html">uWSGI third party plugins</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/CachingCookbook.html">The uWSGI Caching Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/Django_and_nginx.html">Setting up Django and your web server with uWSGI and nginx</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/dreamhost.html">Running uWSGI on Dreamhost shared hosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/heroku_python.html">Running python webapps on Heroku with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/heroku_ruby.html">Running Ruby/Rack webapps on Heroku with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/ReliableFuse.html">Reliably use FUSE filesystems for uWSGI vassals (with Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/DynamicProxying.html">Build a dynamic proxy using RPC and internal routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/GraphiteAndMetrics.html">Setting up Graphite on Ubuntu using the Metrics subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="articles/SerializingAccept.html">Serializing accept(), AKA Thundering Herd, AKA the Zeeg Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/TheArtOfGracefulReloading.html">The Art of Graceful Reloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/FunWithPerlEyetoyRaspberrypi.html">Fun with Perl, Eyetoy and RaspberryPi</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/OffloadingWebsocketsAndSSE.html">Offloading Websockets and Server-Sent Events AKA &quot;Combine them with Django safely&quot;</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/WSGIEnvBehaviour.html">WSGI env behaviour policies</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="AlarmSubsystem.html">The uWSGI alarm subsystem (from 1.3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Caching.html">The uWSGI caching framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebCaching.html">WebCaching framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cron.html">The uWSGI cron-like interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fastrouter.html">The uWSGI FastRouter</a></li>
<li class="toctree-l1"><a class="reference internal" href="InternalRouting.html">uWSGI internal routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Legion.html">The uWSGI Legion subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Locks.html">Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mules.html">uWSGI Mules</a></li>
<li class="toctree-l1"><a class="reference internal" href="OffloadSubsystem.html">The uWSGI offloading subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Queue.html">The uWSGI queue framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="RPC.html">uWSGI RPC Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="SharedArea.html">SharedArea -- share memory pages between uWSGI components</a></li>
<li class="toctree-l1"><a class="reference internal" href="Signals.html">The uWSGI Signal Framework</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The uWSGI Spooler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#spool-files">Spool files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-the-spooler-function-callable">Setting the spooler function/callable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enqueueing-requests-to-a-spooler">Enqueueing requests to a spooler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#external-spoolers">External spoolers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#networked-spoolers">Networked spoolers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#priorities">Priorities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#options">Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tips-and-tricks">Tips and tricks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SubscriptionServer.html">uWSGI Subscription Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="StaticFiles.html">Serving static files with uWSGI (updated to 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="SNI.html">SNI - Server Name Identification (virtual hosting for SSL nodes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeoIP.html">The GeoIP plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Transformations.html">uWSGI Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebSockets.html">WebSocket support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metrics.html">The Metrics subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chunked.html">The Chunked input API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cheaper.html">The uWSGI cheaper subsystem -- adaptive process spawning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emperor.html">The uWSGI Emperor -- multi-app deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="Broodlord.html">Auto-scaling with Broodlord mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="Zerg.html">Zerg mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicApps.html">Adding applications dynamically</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSLScaling.html">Scaling SSL connections (uWSGI 1.9)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Capabilities.html">Setting POSIX Capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cgroups.html">Running uWSGI in a Linux CGroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="KSM.html">Using Linux KSM in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Namespaces.html">Jailing your apps using Linux Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="Namespaces.html#the-old-way-the-namespace-option">The old way: the --namespace option</a></li>
<li class="toctree-l1"><a class="reference internal" href="FreeBSDJails.html">FreeBSD Jails</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkptyRouter.html">The Forkpty Router</a></li>
<li class="toctree-l1"><a class="reference internal" href="TunTapRouter.html">The TunTap Router</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Nagios.html">Monitoring uWSGI with Nagios</a></li>
<li class="toctree-l1"><a class="reference internal" href="SNMP.html">The embedded SNMP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="PushingStats.html">Pushing statistics (from 1.4)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Carbon.html">Integration with Graphite/Carbon</a></li>
<li class="toctree-l1"><a class="reference internal" href="StatsServer.html">The uWSGI Stats Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metrics.html">The Metrics subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Async.html">uWSGI asynchronous/non-blocking modes (updated to uWSGI 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gevent.html">The Gevent loop engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tornado.html">The Tornado loop engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="uGreen.html">uGreen -- uWSGI Green Threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio.html">The asyncio loop engine (CPython &gt;= 3.4, uWSGI &gt;= 2.0.4)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Apache.html">Apache support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cherokee.html">Cherokee support</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTTP.html">Native HTTP support</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTTPS.html">HTTPS 지원 (1.3 버전부터)</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPDY.html">The SPDY router (uWSGI 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lighttpd.html">Lighttpd support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mongrel2.html">Attaching uWSGI to Mongrel2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Nginx.html">Nginx support</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenBSDhttpd.html">Using OpenBSD httpd as proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenBSDhttpd.html#notes">Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Python.html">Python support</a></li>
<li class="toctree-l1"><a class="reference internal" href="PyPy.html">The PyPy plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="PHP.html">Running PHP scripts in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Perl.html">uWSGI Perl support (PSGI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ruby.html">Ruby support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lua.html">Using Lua/WSAPI with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="JVM.html">JVM in the uWSGI server (updated to 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mono.html">The Mono ASP.NET plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="CGI.html">Running CGI scripts on uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="GCCGO.html">The GCCGO plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Symcall.html">The Symcall plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="XSLT.html">The XSLT plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSI.html">SSI (Server Side Includes) plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="V8.html">uWSGI V8 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="GridFS.html">The GridFS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="GlusterFS.html">The GlusterFS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Rados.html">The RADOS plugin</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Pty.html">The Pty plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPNEGO.html">SPNEGO authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="LDAP.html">Configuring uWSGI with LDAP</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Erlang.html">Integrating uWSGI with Erlang</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagementFlag.html">Management Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="Go.html">uWSGI Go support (1.4 only)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.18.html">uWSGI 2.0.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.17.1.html">uWSGI 2.0.17.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.17.html">uWSGI 2.0.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.16.html">uWSGI 2.0.16</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.15.html">uWSGI 2.0.15</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.14.html">uWSGI 2.0.14</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.13.1.html">uWSGI 2.0.13.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.13.html">uWSGI 2.0.13</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.12.html">uWSGI 2.0.12</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.2.html">uWSGI 2.0.11.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.1.html">uWSGI 2.0.11.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.html">uWSGI 2.0.11</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.10.html">uWSGI 2.0.10</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.9.html">uWSGI 2.0.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.8.html">uWSGI 2.0.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.7.html">uWSGI 2.0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.6.html">uWSGI 2.0.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.5.html">uWSGI 2.0.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.4.html">uWSGI 2.0.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.3.html">uWSGI 2.0.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.2.html">uWSGI 2.0.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.1.html">uWSGI 2.0.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.html">uWSGI 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.21.html">uWSGI 1.9.21</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.20.html">uWSGI 1.9.20</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.19.html">uWSGI 1.9.19</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.18.html">uWSGI 1.9.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.17.html">uWSGI 1.9.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.16.html">uWSGI 1.9.16</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.15.html">uWSGI 1.9.15</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.14.html">uWSGI 1.9.14</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.13.html">uWSGI 1.9.13</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.12.html">uWSGI 1.9.12</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.11.html">uWSGI 1.9.11</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.10.html">uWSGI 1.9.10</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.9.html">uWSGI 1.9.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.8.html">uWSGI 1.9.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.7.html">uWSGI 1.9.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.6.html">uWSGI 1.9.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.5.html">uWSGI 1.9.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.4.html">uWSGI 1.9.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.3.html">uWSGI 1.9.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.2.html">uWSGI 1.9.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.1.html">uWSGI 1.9.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.html">uWSGI 1.9</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">uWSGI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>The uWSGI Spooler</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Spooler.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-uwsgi-spooler">
<h1>The uWSGI Spooler<a class="headerlink" href="#the-uwsgi-spooler" title="제목 주소">¶</a></h1>
<p>Updated to uWSGI 2.0.1</p>
<p>Supported on: Perl, Python, Ruby</p>
<p>The Spooler is a queue manager built into uWSGI that works like a printing/mail system.</p>
<p>You can enqueue massive sending of emails, image processing, video encoding, etc. and let the spooler do the hard work in background while your users get their requests served by normal workers.</p>
<p>A spooler works by defining a directory in which &quot;spool files&quot; will be written, every time the spooler find a file in its directory it will parse it and will run a specific function.</p>
<p>You can have multiple spoolers mapped to different directories and even multiple spoolers mapped to the same one.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--spooler</span> <span class="pre">&lt;directory&gt;</span></code> option allows you to generate a spooler process, while the <code class="docutils literal notranslate"><span class="pre">--spooler-processes</span> <span class="pre">&lt;n&gt;</span></code> allows you to set how many processes to spawn for every spooler.</p>
<p>The spooler is able to manage uWSGI signals too, so you can use it as a target for your handlers.</p>
<p>This configuration will generate a spooler for your instance (myspool directory must exists)</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">spooler</span> <span class="o">=</span> <span class="s">myspool</span>
<span class="na">...</span>
</pre></div>
</div>
<p>while this one will create two spoolers:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">spooler</span> <span class="o">=</span> <span class="s">myspool</span>
<span class="na">spooler</span> <span class="o">=</span> <span class="s">myspool2</span>
<span class="na">...</span>
</pre></div>
</div>
<p>having multiple spoolers allows you to prioritize tasks (and eventually parallelize them)</p>
<div class="section" id="spool-files">
<h2>Spool files<a class="headerlink" href="#spool-files" title="제목 주소">¶</a></h2>
<p>Spool files are serialized hashes/dictionaries of strings. The spooler will parse them and pass the resulting hash/dictionary to the spooler function (see below).</p>
<p>The serialization format is the same used for the 'uwsgi' protocol, so you are limited to 64k (even if there is a trick for passing bigger values, see the 'body' magic key below). The modifier1
for spooler packets is the 17, so a {'hello' =&gt; 'world'} hash will be encoded as:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="38%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">header</th>
<th class="head">key1</th>
<th class="head">value1</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>17|14|0|0</td>
<td><a href="#id1"><span class="problematic" id="id2">|</span></a>5|0|h|e|l|l|o</td>
<td><a href="#id3"><span class="problematic" id="id4">|</span></a>5|0|w|o|r|l|d</td>
</tr>
</tbody>
</table>
<p>A locking system allows you to safely manually remove spool files if something goes wrong, or to move them between spooler directories.</p>
<p>Spool dirs over NFS are allowed, but if you do not have proper NFS locking in place, avoid mapping the same spooler NFS directory to spooler on different machines.</p>
</div>
<div class="section" id="setting-the-spooler-function-callable">
<h2>Setting the spooler function/callable<a class="headerlink" href="#setting-the-spooler-function-callable" title="제목 주소">¶</a></h2>
<p>Because there are dozens of different ways to enqueue spooler requests, we're going to cover receiving the requests first.</p>
<p>To have a fully operational spooler you need to define a &quot;spooler function/callable&quot; to process the requests.</p>
<p>Regardless of the the number of configured spoolers, the same function will be executed.
It is up to the developer to instruct it to recognize tasks.
If you don't process requests, the spool directory will just fill up.</p>
<p>This function must returns an integer value:</p>
<ul class="simple">
<li>-2 (SPOOL_OK) -- the task has been completed, the spool file will be removed</li>
<li>-1 (SPOOL_RETRY) -- something is temporarily wrong, the task will be retried at the next spooler iteration</li>
<li>0 (SPOOL_IGNORE) -- ignore this task, if multiple languages are loaded in the instance all of them will fight for managing the task. This return values allows you to skip a task in specific languages.</li>
</ul>
<p>Any other value will be interpreted as -1 (retry).</p>
<p>Each language plugin has its own way to define the spooler function:</p>
<p>Perl:</p>
<div class="highlight-pl notranslate"><div class="highlight"><pre><span></span><span class="nn">uwsgi::</span><span class="n">spooler</span><span class="p">(</span>
    <span class="k">sub</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$env</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
        <span class="k">print</span> <span class="nv">$env</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">foobar</span><span class="p">};</span>
        <span class="k">return</span> <span class="nn">uwsgi::</span><span class="n">SPOOL_OK</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>
<span class="c1"># hint - uwsgi:: is available when running using perl-exec= or psgi=</span>
<span class="c1"># no don&#39;t need to use &quot;use&quot; or &quot;require&quot; it, it&#39;s already there.</span>
</pre></div>
</div>
<p>Python:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uwsgi</span>

<span class="k">def</span> <span class="nf">my_spooler</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;foobar&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">uwsgi</span><span class="o">.</span><span class="n">SPOOL_OK</span>

<span class="n">uwsgi</span><span class="o">.</span><span class="n">spooler</span> <span class="o">=</span> <span class="n">my_spooler</span>
</pre></div>
</div>
<p>Ruby:</p>
<div class="highlight-rb notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="nn">UWSGI</span>
     <span class="kp">module_function</span>
     <span class="k">def</span> <span class="nf">spooler</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
             <span class="nb">puts</span> <span class="n">env</span><span class="o">.</span><span class="n">inspect</span>
             <span class="k">return</span> <span class="no">UWSGI</span><span class="o">::</span><span class="no">SPOOL_OK</span>
     <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Spooler functions must be defined in the master process, so if you are in lazy-apps mode, be sure to place it in a file that is parsed
early in the server setup. (in Python you can use --shared-import, in Ruby --shared-require, in Perl --perl-exec).</p>
<p>Python has support for importing code directly in the spooler with the <code class="docutils literal notranslate"><span class="pre">--spooler-python-import</span></code> option.</p>
</div>
<div class="section" id="enqueueing-requests-to-a-spooler">
<h2>Enqueueing requests to a spooler<a class="headerlink" href="#enqueueing-requests-to-a-spooler" title="제목 주소">¶</a></h2>
<p>The 'spool' api function allows you to enqueue a hash/dictionary into the spooler specified by the instance:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># add this to your instance .ini file</span>
<span class="na">spooler</span><span class="o">=</span><span class="s">/path/to/spooler</span>
<span class="c1"># that&#39;s it! now use one of the code blocks below to send requests</span>
<span class="c1"># note: you&#39;ll still need to register some sort of receiving function (specified above)</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">uwsgi</span>
<span class="n">uwsgi</span><span class="o">.</span><span class="n">spool</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Kratos&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">:</span> <span class="s1">&#39;the same of Zeus&#39;</span><span class="p">})</span>
<span class="c1"># or</span>
<span class="n">uwsgi</span><span class="o">.</span><span class="n">spool</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Kratos&#39;</span><span class="p">,</span> <span class="n">surname</span><span class="o">=</span><span class="s1">&#39;the same of Zeus&#39;</span><span class="p">)</span>
<span class="c1"># for python3 use bytes instead of strings !!!</span>
</pre></div>
</div>
<div class="highlight-pl notranslate"><div class="highlight"><pre><span></span><span class="c1"># perl</span>
<span class="nn">uwsgi::</span><span class="n">spool</span><span class="p">({</span><span class="n">foo</span> <span class="o">=&gt;</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=&gt;</span> <span class="s">&#39;Kratos&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=&gt;</span> <span class="s">&#39;the same of Zeus&#39;</span><span class="p">})</span>
<span class="c1"># the uwsgi:: functions are available when executed within psgi or perl-exec</span>
</pre></div>
</div>
<div class="highlight-rb notranslate"><div class="highlight"><pre><span></span><span class="c1"># ruby</span>
<span class="no">UWSGI</span><span class="o">.</span><span class="n">spool</span><span class="p">(</span><span class="n">foo</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="nb">name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Kratos&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=&gt;</span> <span class="s1">&#39;the same of Zeus&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Some keys have a special meaning:</p>
<ul class="simple">
<li>'spooler' =&gt; specify the ABSOLUTE path of the spooler that has to manage this task</li>
<li>'at' =&gt; unix time at which the task must be executed (read: the task will not be run until the 'at' time is passed)</li>
<li>'priority' =&gt; this will be the subdirectory in the spooler directory in which the task will be placed, you can use that trick to give a good-enough prioritization to tasks (for better approach use multiple spoolers)</li>
<li>'body' =&gt; use this key for objects bigger than 64k, the blob will be appended to the serialzed uwsgi packet and passed back to the spooler function as the 'body' argument</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">주석</p>
<p class="last">Spool arguments must be strings (or bytes for python3). The API functions will try to cast non-string values to strings/bytes, but do not rely on that functionality!</p>
</div>
</div>
<div class="section" id="external-spoolers">
<h2>External spoolers<a class="headerlink" href="#external-spoolers" title="제목 주소">¶</a></h2>
<p>You could want to implement a centralized spooler for your server across many uWSGI instances.</p>
<p>A single instance will manage all of the tasks enqueued by multiple uWSGI instances.</p>
<p>To accomplish this setup, each uWSGI instance has to know which spooler directories are valid (consider it a form of security).</p>
<p>To add an external spooler directory use the <code class="docutils literal notranslate"><span class="pre">--spooler-external</span> <span class="pre">&lt;directory&gt;</span></code> option, then add to it using the spool function.</p>
<p>The spooler locking subsystem will avoid any messes that you might think could occur.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">spooler-external</span> <span class="o">=</span> <span class="s">/var/spool/uwsgi/external</span>
<span class="na">...</span>
</pre></div>
</div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">import</span> <span class="nn">uwsgi</span>
<span class="n">uwsgi</span><span class="o">.</span><span class="n">spool</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>  <span class="s1">&#39;spooler&#39;</span><span class="p">:</span> <span class="s1">&#39;/var/spool/uwsgi/external&#39;</span><span class="p">})</span>
<span class="c1"># or</span>
<span class="n">uwsgi</span><span class="o">.</span><span class="n">spool</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">spooler</span><span class="o">=</span><span class="s1">&#39;/var/spool/uwsgi/external&#39;</span><span class="p">)</span>
<span class="c1"># for python3 use bytes instead of strings !!!</span>
</pre></div>
</div>
</div>
<div class="section" id="networked-spoolers">
<h2>Networked spoolers<a class="headerlink" href="#networked-spoolers" title="제목 주소">¶</a></h2>
<p>You can even enqueue tasks over the network (be sure the 'spooler' plugin is loaded in your instance, but generally it is built in by default).</p>
<p>As we have already seen, spooler packets have modifier1 17, you can directly send those packets to an uWSGI socket of an instance with a spooler enabled.</p>
<p>We will use the Perl <code class="docutils literal notranslate"><span class="pre">Net::uwsgi</span></code> module (exposing a handy uwsgi_spool function) in this example (but feel free to use whatever you want to write the spool files).</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>
<span class="k">use</span> <span class="nn">Net::uwsgi</span><span class="p">;</span>
<span class="n">uwsgi_spool</span><span class="p">(</span><span class="s">&#39;localhost:3031&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;test&#39;</span><span class="o">=&gt;</span><span class="s">&#39;test001&#39;</span><span class="p">,</span><span class="s">&#39;argh&#39;</span><span class="o">=&gt;</span><span class="s">&#39;boh&#39;</span><span class="p">,</span><span class="s">&#39;foo&#39;</span><span class="o">=&gt;</span><span class="s">&#39;bar&#39;</span><span class="p">});</span>
<span class="n">uwsgi_spool</span><span class="p">(</span><span class="s">&#39;/path/to/my.sock&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;test&#39;</span><span class="o">=&gt;</span><span class="s">&#39;test001&#39;</span><span class="p">,</span><span class="s">&#39;argh&#39;</span><span class="o">=&gt;</span><span class="s">&#39;boh&#39;</span><span class="p">,</span><span class="s">&#39;foo&#39;</span><span class="o">=&gt;</span><span class="s">&#39;bar&#39;</span><span class="p">});</span>
</pre></div>
</div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">/path/to/my.sock</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">localhost:3031</span>
<span class="na">spooler</span> <span class="o">=</span> <span class="s">/path/for/files</span>
<span class="na">spooler-processes</span><span class="o">=</span><span class="s">1</span>
<span class="na">perl-exec</span> <span class="o">=</span> <span class="s">/path/for/script-which-registers-spooler-sub.pl</span>
<span class="na">...</span>
</pre></div>
</div>
<p>(thanks brianhorakh for the example)</p>
</div>
<div class="section" id="priorities">
<h2>Priorities<a class="headerlink" href="#priorities" title="제목 주소">¶</a></h2>
<p>We have already seen that you can use the 'priority' key to give order in spooler parsing.</p>
<p>While having multiple spoolers would be an extremely better approach, on system with few resources 'priorities' are a good trick.</p>
<p>They works only if you enable the <code class="docutils literal notranslate"><span class="pre">--spooler-ordered</span></code> option. This option allows the spooler to scan directories entry in alphabetical order.</p>
<p>If during the scan a directory with a 'number' name is found, the scan is suspended and the content of this subdirectory will be explored for tasks.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>/spool
/spool/ztask
/spool/xtask
/spool/1/task1
/spool/1/task0
/spool/2/foo
</pre></div>
</div>
<p>With this layout the order in which files will be parsed is:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>/spool/1/task0
/spool/1/task1
/spool/2/foo
/spool/xtask
/spool/ztask
</pre></div>
</div>
<p>Remember, priorities only work for subdirectories named as 'numbers' and you need the <code class="docutils literal notranslate"><span class="pre">--spooler-ordered</span></code> option.</p>
<p>The uWSGI spooler gives special names to tasks so the ordering of enqueuing is always respected.</p>
</div>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="제목 주소">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">spooler=directory</span></code>
run a spooler on the specified directory</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-external=directory</span></code>
map spoolers requests to a spooler directory managed by an external instance</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-ordered</span></code>
try to order the execution of spooler tasks (uses scandir instead of readdir)</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-chdir=directory</span></code>
call chdir() to specified directory before each spooler task</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-processes=##</span></code>
set the number of processes for spoolers</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-quiet</span></code>
do not be verbose with spooler tasks</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-max-tasks=##</span></code>
set the maximum number of tasks to run before recycling a spooler (to help alleviate memory leaks)</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-signal-as-task</span></code>
combined use with <code class="docutils literal notranslate"><span class="pre">spooler-max-tasks</span></code>. enable this, spooler will treat signal events as task.
run signal handler will also increase the spooler task count.</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-harakiri=##</span></code>
set harakiri timeout for spooler tasks, see [harakiri] for more information.</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-frequency=##</span></code>
set the spooler frequency</p>
<p><code class="docutils literal notranslate"><span class="pre">spooler-python-import=???</span></code>
import a python module directly in the spooler</p>
</div>
<div class="section" id="tips-and-tricks">
<h2>Tips and tricks<a class="headerlink" href="#tips-and-tricks" title="제목 주소">¶</a></h2>
<p>You can re-enqueue a spooler request by returning <code class="docutils literal notranslate"><span class="pre">uwsgi.SPOOL_RETRY</span></code> in your callable:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">call_me_again_and_again</span><span class="p">(</span><span class="n">env</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">uwsgi</span><span class="o">.</span><span class="n">SPOOL_RETRY</span>
</pre></div>
</div>
<p>You can set the spooler poll frequency using the <code class="docutils literal notranslate"><span class="pre">--spooler-frequency</span> <span class="pre">&lt;secs&gt;</span></code> option (default 30 seconds).</p>
<p>You could use the <a class="reference internal" href="Caching.html"><span class="doc">The uWSGI caching framework</span></a> or <a class="reference internal" href="SharedArea.html"><span class="doc">SharedArea -- share memory pages between uWSGI components</span></a> to exchange memory structures between spoolers and workers.</p>
<p>Python (uwsgidecorators.py) and Ruby (uwsgidsl.rb) exposes higher-level facilities to manage the spooler, try to use them instead of the low-level approach described here.</p>
<p>When using a spooler as a target for a uWSGI signal handler you can specify which one to route signal to using its ABSOLUTE directory name.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="SubscriptionServer.html" class="btn btn-neutral float-right" title="uWSGI Subscription Server" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Signals.html" class="btn btn-neutral" title="The uWSGI Signal Framework" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2016, uWSGI.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0',
            LANGUAGE:'ko',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>