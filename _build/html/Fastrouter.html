

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ko" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ko" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The uWSGI FastRouter &mdash; uWSGI 2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="색인" href="genindex.html" />
    <link rel="search" title="검색" href="search.html" />
    <link rel="next" title="uWSGI internal routing" href="InternalRouting.html" />
    <link rel="prev" title="The uWSGI cron-like interface" href="Cron.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> uWSGI
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="WSGIquickstart.html">Quickstart for Python/WSGI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="PSGIquickstart.html">Quickstart for perl/PSGI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="RackQuickstart.html">Quickstart for ruby/Rack applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="Snippets.html">Snippets</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Download.html">Getting uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Installing uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildSystem.html">The uWSGI build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="Management.html">Managing the uWSGI server</a></li>
<li class="toctree-l1"><a class="reference internal" href="LanguagesAndPlatforms.html">Supported languages and platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="SupportedPlatforms.html">Supported Platforms/Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebServers.html">Web server integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThingsToKnow.html">Things to know (best practices and &quot;issues&quot;) READ IT !!!</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">Configuring uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="FallbackConfig.html">Fallback configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigLogic.html">Configuration logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="Options.html">uWSGI Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="CustomOptions.html">Defining new options for your instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="ParsingOrder.html">How uWSGI parses config files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Vars.html">uwsgi protocol magic variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="Protocol.html">The uwsgi Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="AttachingDaemons.html">Managing external daemons/services</a></li>
<li class="toctree-l1"><a class="reference internal" href="MasterFIFO.html">The Master FIFO</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inetd.html">Socket activation with inetd/xinetd</a></li>
<li class="toctree-l1"><a class="reference internal" href="Upstart.html">Running uWSGI via Upstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="Systemd.html">Systemd</a></li>
<li class="toctree-l1"><a class="reference internal" href="Circus.html">Running uWSGI instances with Circus</a></li>
<li class="toctree-l1"><a class="reference internal" href="Embed.html">Embedding an application in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogFormat.html">Formatting uWSGI requests logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogEncoders.html">Log encoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hooks.html">Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="WorkerOverride.html">Overriding Workers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThirdPartyPlugins.html">uWSGI third party plugins</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/CachingCookbook.html">The uWSGI Caching Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/Django_and_nginx.html">Setting up Django and your web server with uWSGI and nginx</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/dreamhost.html">Running uWSGI on Dreamhost shared hosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/heroku_python.html">Running python webapps on Heroku with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/heroku_ruby.html">Running Ruby/Rack webapps on Heroku with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/ReliableFuse.html">Reliably use FUSE filesystems for uWSGI vassals (with Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/DynamicProxying.html">Build a dynamic proxy using RPC and internal routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/GraphiteAndMetrics.html">Setting up Graphite on Ubuntu using the Metrics subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="articles/SerializingAccept.html">Serializing accept(), AKA Thundering Herd, AKA the Zeeg Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/TheArtOfGracefulReloading.html">The Art of Graceful Reloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/FunWithPerlEyetoyRaspberrypi.html">Fun with Perl, Eyetoy and RaspberryPi</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/OffloadingWebsocketsAndSSE.html">Offloading Websockets and Server-Sent Events AKA &quot;Combine them with Django safely&quot;</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/WSGIEnvBehaviour.html">WSGI env behaviour policies</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="AlarmSubsystem.html">The uWSGI alarm subsystem (from 1.3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Caching.html">The uWSGI caching framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebCaching.html">WebCaching framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cron.html">The uWSGI cron-like interface</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The uWSGI FastRouter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#way-1-fastrouter-use-base">Way 1: --fastrouter-use-base</a></li>
<li class="toctree-l2"><a class="reference internal" href="#way-2-fastrouter-use-pattern">Way 2: --fastrouter-use-pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="#way-3-fastrouter-use-cache">Way 3: --fastrouter-use-cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#way-4-fastrouter-subscription-server">Way 4: --fastrouter-subscription-server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mapping-files">Mapping files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#way-5-fastrouter-use-code-string">Way 5: --fastrouter-use-code-string</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cheap-mode-and-shared-sockets">Cheap mode and shared sockets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#post-buffering-mode-uwsgi-2-0-9">Post-buffering mode (uWSGI &gt;= 2.0.9)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="InternalRouting.html">uWSGI internal routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Legion.html">The uWSGI Legion subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Locks.html">Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mules.html">uWSGI Mules</a></li>
<li class="toctree-l1"><a class="reference internal" href="OffloadSubsystem.html">The uWSGI offloading subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Queue.html">The uWSGI queue framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="RPC.html">uWSGI RPC Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="SharedArea.html">SharedArea -- share memory pages between uWSGI components</a></li>
<li class="toctree-l1"><a class="reference internal" href="Signals.html">The uWSGI Signal Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Spooler.html">The uWSGI Spooler</a></li>
<li class="toctree-l1"><a class="reference internal" href="SubscriptionServer.html">uWSGI Subscription Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="StaticFiles.html">Serving static files with uWSGI (updated to 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="SNI.html">SNI - Server Name Identification (virtual hosting for SSL nodes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeoIP.html">The GeoIP plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Transformations.html">uWSGI Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebSockets.html">WebSocket support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metrics.html">The Metrics subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chunked.html">The Chunked input API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cheaper.html">The uWSGI cheaper subsystem -- adaptive process spawning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emperor.html">The uWSGI Emperor -- multi-app deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="Broodlord.html">Auto-scaling with Broodlord mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="Zerg.html">Zerg mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicApps.html">Adding applications dynamically</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSLScaling.html">Scaling SSL connections (uWSGI 1.9)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Capabilities.html">Setting POSIX Capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cgroups.html">Running uWSGI in a Linux CGroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="KSM.html">Using Linux KSM in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Namespaces.html">Jailing your apps using Linux Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="Namespaces.html#the-old-way-the-namespace-option">The old way: the --namespace option</a></li>
<li class="toctree-l1"><a class="reference internal" href="FreeBSDJails.html">FreeBSD Jails</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkptyRouter.html">The Forkpty Router</a></li>
<li class="toctree-l1"><a class="reference internal" href="TunTapRouter.html">The TunTap Router</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Nagios.html">Monitoring uWSGI with Nagios</a></li>
<li class="toctree-l1"><a class="reference internal" href="SNMP.html">The embedded SNMP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="PushingStats.html">Pushing statistics (from 1.4)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Carbon.html">Integration with Graphite/Carbon</a></li>
<li class="toctree-l1"><a class="reference internal" href="StatsServer.html">The uWSGI Stats Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metrics.html">The Metrics subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Async.html">uWSGI asynchronous/non-blocking modes (updated to uWSGI 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gevent.html">The Gevent loop engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tornado.html">The Tornado loop engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="uGreen.html">uGreen -- uWSGI Green Threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio.html">The asyncio loop engine (CPython &gt;= 3.4, uWSGI &gt;= 2.0.4)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Apache.html">Apache support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cherokee.html">Cherokee support</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTTP.html">Native HTTP support</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTTPS.html">HTTPS 지원 (1.3 버전부터)</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPDY.html">The SPDY router (uWSGI 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lighttpd.html">Lighttpd support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mongrel2.html">Attaching uWSGI to Mongrel2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Nginx.html">Nginx support</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenBSDhttpd.html">Using OpenBSD httpd as proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenBSDhttpd.html#notes">Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Python.html">Python support</a></li>
<li class="toctree-l1"><a class="reference internal" href="PyPy.html">The PyPy plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="PHP.html">Running PHP scripts in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Perl.html">uWSGI Perl support (PSGI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ruby.html">Ruby support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lua.html">Using Lua/WSAPI with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="JVM.html">JVM in the uWSGI server (updated to 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mono.html">The Mono ASP.NET plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="CGI.html">Running CGI scripts on uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="GCCGO.html">The GCCGO plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Symcall.html">The Symcall plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="XSLT.html">The XSLT plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSI.html">SSI (Server Side Includes) plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="V8.html">uWSGI V8 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="GridFS.html">The GridFS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="GlusterFS.html">The GlusterFS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Rados.html">The RADOS plugin</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Pty.html">The Pty plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPNEGO.html">SPNEGO authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="LDAP.html">Configuring uWSGI with LDAP</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Erlang.html">Integrating uWSGI with Erlang</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagementFlag.html">Management Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="Go.html">uWSGI Go support (1.4 only)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.18.html">uWSGI 2.0.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.17.1.html">uWSGI 2.0.17.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.17.html">uWSGI 2.0.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.16.html">uWSGI 2.0.16</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.15.html">uWSGI 2.0.15</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.14.html">uWSGI 2.0.14</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.13.1.html">uWSGI 2.0.13.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.13.html">uWSGI 2.0.13</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.12.html">uWSGI 2.0.12</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.2.html">uWSGI 2.0.11.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.1.html">uWSGI 2.0.11.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.html">uWSGI 2.0.11</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.10.html">uWSGI 2.0.10</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.9.html">uWSGI 2.0.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.8.html">uWSGI 2.0.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.7.html">uWSGI 2.0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.6.html">uWSGI 2.0.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.5.html">uWSGI 2.0.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.4.html">uWSGI 2.0.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.3.html">uWSGI 2.0.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.2.html">uWSGI 2.0.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.1.html">uWSGI 2.0.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.html">uWSGI 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.21.html">uWSGI 1.9.21</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.20.html">uWSGI 1.9.20</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.19.html">uWSGI 1.9.19</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.18.html">uWSGI 1.9.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.17.html">uWSGI 1.9.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.16.html">uWSGI 1.9.16</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.15.html">uWSGI 1.9.15</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.14.html">uWSGI 1.9.14</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.13.html">uWSGI 1.9.13</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.12.html">uWSGI 1.9.12</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.11.html">uWSGI 1.9.11</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.10.html">uWSGI 1.9.10</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.9.html">uWSGI 1.9.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.8.html">uWSGI 1.9.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.7.html">uWSGI 1.9.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.6.html">uWSGI 1.9.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.5.html">uWSGI 1.9.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.4.html">uWSGI 1.9.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.3.html">uWSGI 1.9.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.2.html">uWSGI 1.9.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.1.html">uWSGI 1.9.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.html">uWSGI 1.9</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">uWSGI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>The uWSGI FastRouter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Fastrouter.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-uwsgi-fastrouter">
<h1>The uWSGI FastRouter<a class="headerlink" href="#the-uwsgi-fastrouter" title="제목 주소">¶</a></h1>
<p>For advanced setups uWSGI includes the &quot;fastrouter&quot; plugin, a
proxy/load-balancer/router speaking the uwsgi protocol. It is built in by
default.  You can put it between your webserver and real uWSGI instances to
have more control over the routing of HTTP requests to your application
servers.</p>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="제목 주소">¶</a></h2>
<p>First of all you have to run the fastrouter, binding it to a specific address.
Multiple addresses are supported as well.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --fastrouter <span class="m">127</span>.0.0.1:3017 --fastrouter /tmp/uwsgi.sock --fastrouter @foobar
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">주석</p>
<p class="last">This is the most useless Fastrouter setup in the world.</p>
</div>
<p>Congratulations! You have just run the most useless Fastrouter setup in the
world. Simply binding the fastrouter to a couple of addresses will not instruct
it on how to route requests. To give it intelligence you have to tell it how to
route requests.</p>
</div>
<div class="section" id="way-1-fastrouter-use-base">
<h2>Way 1: --fastrouter-use-base<a class="headerlink" href="#way-1-fastrouter-use-base" title="제목 주소">¶</a></h2>
<p>This option will tell the fastrouter to connect to a UNIX socket with the same
name of the requested host in a specified directory.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --fastrouter <span class="m">127</span>.0.0.1:3017 --fastrouter-use-base /tmp/sockets/
</pre></div>
</div>
<p>If you receive a request for <code class="docutils literal notranslate"><span class="pre">example.com</span></code> the fastrouter will forward the
request to <code class="docutils literal notranslate"><span class="pre">/tmp/sockets/example.com</span></code>.</p>
</div>
<div class="section" id="way-2-fastrouter-use-pattern">
<h2>Way 2: --fastrouter-use-pattern<a class="headerlink" href="#way-2-fastrouter-use-pattern" title="제목 주소">¶</a></h2>
<p>Same as the previous setup but you will be able to use a pattern, with <code class="docutils literal notranslate"><span class="pre">%s</span></code>
mapping to the requested key/hostname.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --fastrouter <span class="m">127</span>.0.0.1:3017 --fastrouter-use-pattern /tmp/sockets/%s/uwsgi.sock
</pre></div>
</div>
<p>Requests for <code class="docutils literal notranslate"><span class="pre">example.com</span></code> will be mapped to
<code class="docutils literal notranslate"><span class="pre">/tmp/sockets/example.com/uwsgi.sock</span></code>.</p>
</div>
<div class="section" id="way-3-fastrouter-use-cache">
<h2>Way 3: --fastrouter-use-cache<a class="headerlink" href="#way-3-fastrouter-use-cache" title="제목 주소">¶</a></h2>
<p>You can store the key/value mappings in the <a class="reference internal" href="Caching.html"><span class="doc">uWSGI cache</span></a>.
Choose a way to fill the cache, for instance a Python script like this...</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uwsgi</span>
<span class="c1"># Requests for example.com on port 8000 will go to 127.0.0.1:4040</span>
<span class="n">uwsgi</span><span class="o">.</span><span class="n">cache_set</span><span class="p">(</span><span class="s2">&quot;example.com:8000&quot;</span><span class="p">,</span> <span class="s2">&quot;127.0.0.1:4040&quot;</span><span class="p">)</span>
<span class="c1"># Requests for unbit.it will go to 127.0.0.1:4040 with the modifier1 set to 5 (perl/PSGI)</span>
<span class="n">uwsgi</span><span class="o">.</span><span class="n">cache_set</span><span class="p">(</span><span class="s2">&quot;unbit.it&quot;</span><span class="p">,</span> <span class="s2">&quot;127.0.0.1:4040,5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then run your Fastrouter-enabled server, telling it to run the script first.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --fastrouter <span class="m">127</span>.0.0.1:3017 --fastrouter-use-cache --cache <span class="m">100</span> --file foobar.py
</pre></div>
</div>
</div>
<div class="section" id="way-4-fastrouter-subscription-server">
<h2>Way 4: --fastrouter-subscription-server<a class="headerlink" href="#way-4-fastrouter-subscription-server" title="제목 주소">¶</a></h2>
<p>This is probably one of the best way for massive auto-scaling hosting. It uses
the <a class="reference internal" href="SubscriptionServer.html"><span class="doc">subscription server</span></a> to allow instances to
announce themselves and subscribe to the fastrouter.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --fastrouter <span class="m">127</span>.0.0.1:3017 --fastrouter-subscription-server <span class="m">192</span>.168.0.100:7000
</pre></div>
</div>
<p>This will spawn a subscription server on address 192.168.0.100 port 7000</p>
<p>Now you can spawn your instances subscribing to the fastrouter:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --socket :3031 -M --subscribe-to <span class="m">192</span>.168.0.100:7000:example.com
uwsgi --socket :3032 -M --subscribe-to <span class="m">192</span>.168.0.100:7000:unbit.it,5 --subscribe-to <span class="m">192</span>.168.0.100:7000:uwsgi.it
</pre></div>
</div>
<p>As you probably noted, you can subscribe to multiple fastrouters, with multiple
keys. Multiple instances subscribing to the same fastrouter with the same key
will automatically get load balanced and monitored. Handy, isn't it?  Like with
the caching key/value store, <code class="docutils literal notranslate"><span class="pre">modifier1</span></code> can be set with a comma. (<code class="docutils literal notranslate"><span class="pre">,5</span></code>
above) Another feature of the subscription system is avoiding to choose ports.
You can bind instances to random port and the subscription system will send the
real value to the subscription server.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --socket <span class="m">192</span>.168.0.100:0 -M --subscribe-to <span class="m">192</span>.168.0.100:7000:example.com
</pre></div>
</div>
<div class="section" id="mapping-files">
<h3>Mapping files<a class="headerlink" href="#mapping-files" title="제목 주소">¶</a></h3>
<p>If you need to specify a massive amount of keys, you can use a mapping file
instead.</p>
<div class="highlight-plain notranslate"><div class="highlight"><pre><span></span># mappings.txt
unbit.it
unbit.it:8000,5
uwsgi.it
projects.unbit.it
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --socket :3031 -M --subscribe-to <span class="m">192</span>.168.0.100:7000:@mappings.txt
</pre></div>
</div>
</div>
</div>
<div class="section" id="way-5-fastrouter-use-code-string">
<h2>Way 5: --fastrouter-use-code-string<a class="headerlink" href="#way-5-fastrouter-use-code-string" title="제목 주소">¶</a></h2>
<p>If Darth Vader wears a t-shirt with your face (and in some other corner cases
too), you can customize the fastrouter with code-driven mappings.  Choose a
uWSGI-supported language (like Python or Lua) and define your mapping function.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;127.0.0.1:3031&#39;</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --fastrouter <span class="m">127</span>.0.0.1:3017 --fastrouter-use-code-string <span class="m">0</span>:mapper.py:get
</pre></div>
</div>
<p>This will instruct the fastrouter to load the script <code class="docutils literal notranslate"><span class="pre">mapper.py</span></code> using plugin
(modifier1) 0 and call the 'get' global, passing it the key.  In the previous
example you will always route requests to 127.0.0.1:3031. Let's create
a more advanced system, for fun!</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">domains</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">domains</span><span class="p">[</span><span class="s1">&#39;example.com&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;127.0.0.1:3031&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.0.100:3032&#39;</span><span class="p">),</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">domains</span><span class="p">[</span><span class="s1">&#39;unbit.it&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;127.0.0.1:3035,5&#39;</span><span class="p">,</span> <span class="s1">&#39;192.168.0.100:3035,5&#39;</span><span class="p">),</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="n">DEFAULT_NODE</span> <span class="o">=</span> <span class="s1">&#39;192.168.0.1:1717&#39;</span>

<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DEFAULT_NODE</span>

    <span class="c1"># get the node to forward requests to</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span>
    <span class="n">current_node</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">current_node</span><span class="p">]</span>

    <span class="c1"># round robin :P</span>
    <span class="n">next_node</span> <span class="o">=</span> <span class="n">current_node</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">next_node</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
        <span class="n">next_node</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">domains</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_node</span>

    <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --fastrouter <span class="m">127</span>.0.0.1:3017 --fastrouter-use-code-string <span class="m">0</span>:megamapper.py:get
</pre></div>
</div>
<p>With only few lines we have implemented round-robin load-balancing with a
fallback node. Pow!  You could add some form of node monitoring, starting
threads in the script, or other insane things. (Be sure to add them to the
docs!)</p>
<div class="admonition attention">
<p class="first admonition-title">주의</p>
<p class="last">Remember to not put blocking code in your functions. The
fastrouter is totally non-blocking, do not ruin it!</p>
</div>
</div>
<div class="section" id="cheap-mode-and-shared-sockets">
<h2>Cheap mode and shared sockets<a class="headerlink" href="#cheap-mode-and-shared-sockets" title="제목 주소">¶</a></h2>
<p>A common setup is having a webserver/proxy connected to a fastrouter and a
series of uWSGI instances subscribed to it.  Normally you'd use the webserver
node as a uWSGI instance node. This node will subscribe to the local
fastrouter. Well... don't waste cycles on that!  Shared sockets are a way to
share sockets among various uWSGI components. Let's use that to share a socket
between the fastrouter and uWSGI instance.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="c1">;create a shared socket (the webserver will connect to it)</span>
<span class="na">shared-socket</span> <span class="o">=</span> <span class="s">127.0.0.1:3031</span>

<span class="c1">; bind the fastrouter to the shared socket</span>
<span class="na">fastrouter</span> <span class="o">=</span> <span class="s">=0</span>
<span class="c1">; bind an instance to the same socket</span>
<span class="na">socket</span> <span class="o">=</span> <span class="s">=0</span>

<span class="c1">; having a master is always a good thing...</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">true</span>
<span class="c1">; our subscription server</span>
<span class="na">fastrouter-subscription-server</span> <span class="o">=</span> <span class="s">192.168.0.100:4040</span>
<span class="c1">; our app</span>
<span class="na">wsgi-file</span> <span class="o">=</span> <span class="s">/var/www/myheavyapp.wsgi</span>
<span class="c1">; a bunch of processes</span>
<span class="na">processes</span> <span class="o">=</span> <span class="s">4</span>
<span class="c1">; and put the fastrouter in cheap mode</span>
<span class="na">fastrouter-cheap</span> <span class="o">=</span> <span class="s">true</span>
</pre></div>
</div>
<p>With this setup your requests will go directly to your app (no proxy overhead)
or to the fastrouter (to pass requests to remote nodes).  When the fastrouter
is in cheap mode, it will not respond to requests until a node is available.
This means that when there are no nodes subscribed, only your local app will
respond.  When all of the nodes go down, the fastrouter will return in cheap
mode. Seeing a pattern? Another step to awesome autoscaling.</p>
</div>
<div class="section" id="post-buffering-mode-uwsgi-2-0-9">
<h2>Post-buffering mode (uWSGI &gt;= 2.0.9)<a class="headerlink" href="#post-buffering-mode-uwsgi-2-0-9" title="제목 주소">¶</a></h2>
<p>The fastrouter is (by default) a streaming proxy. This means that as soon as the uwsgi packet (read: the request headers) is parsed, it is forwarded to the backend/backends.</p>
<p>Now, if your web-proxy is a streaming-one too (like apache, or the uWSGI http router), your app could be blocked for ages in case of a request with a body. To be more clear:</p>
<ul class="simple">
<li>the client starts the request sending http headers</li>
<li>the web proxy receives it and send to the fastrouter</li>
<li>the fastrouter receives it and send to the backend</li>
<li>the client starts sending chunks of the request body (like a file upload)</li>
<li>the web proxy receives them and forward to the fastrouter</li>
<li>the fastrouter receives them and forward to the backend and so on</li>
</ul>
<p>now, imagine 10 concurrent clients doing this thing and you will end with 10 application server workers (or threads) busy for un undefined amount of time. (note: this problem is amplified by the fact that generally the number of threads/process is very limited, even in async modes you have a limited of concurrent requests but it is generally so high that the problem is not so relevant)</p>
<p>Web-proxies like nginx are &quot;buffered&quot;, so they wait til the whole request (and its body) has been read, and then it sends it to the backends.</p>
<p>You can instruct the fastrouter to behave like nginx with the <code class="docutils literal notranslate"><span class="pre">--fastrouter-post-buffering</span> <span class="pre">&lt;n&gt;</span></code> option, where &lt;n&gt; is the size of the request body after which the body will be stored to disk (as a temporary file) instead of memory:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">fastrouter</span> <span class="o">=</span> <span class="s">127.0.0.1:3031</span>
<span class="na">fastrouter-to</span> <span class="o">=</span> <span class="s">/var/run/app.socket</span>
<span class="na">fastrouter-post-buffering</span> <span class="o">=</span> <span class="s">8192</span>
</pre></div>
</div>
<p>will put the fastrouter in buffered mode, storing on a temp file every body bigger than 8192 bytes, and on memory everything lower (or equal)</p>
<p>Remember that post-buffering, is not a good-for-all solution (otherwise it would be the default), enabling it breaks websockets, chunked input, upload progress, iceast streaming and so on. Enable it only when needed.</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="제목 주소">¶</a></h2>
<ul class="simple">
<li>The fastrouter uses the following vars (in order of precedence) to choose a key to use:<ul>
<li><code class="docutils literal notranslate"><span class="pre">UWSGI_FASTROUTER_KEY</span></code> - the most versatile, as it doesn't depend on the request in any way</li>
<li><code class="docutils literal notranslate"><span class="pre">HTTP_HOST</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code></li>
</ul>
</li>
<li>You can increase the number of async events the fastrouter can manage (by
default it is system-dependent) using --fastrouter-events</li>
</ul>
<p>You can change the default timeout with --fastrouter-timeout By default the
fastrouter will set fd socket passing when used over unix sockets. If you do
not want it add --no-fd-passing</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="InternalRouting.html" class="btn btn-neutral float-right" title="uWSGI internal routing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Cron.html" class="btn btn-neutral" title="The uWSGI cron-like interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2016, uWSGI.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0',
            LANGUAGE:'ko',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>