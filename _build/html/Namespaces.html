

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ko" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ko" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Jailing your apps using Linux Namespaces &mdash; uWSGI 2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="색인" href="genindex.html" />
    <link rel="search" title="검색" href="search.html" />
    <link rel="next" title="FreeBSD Jails" href="FreeBSDJails.html" />
    <link rel="prev" title="Using Linux KSM in uWSGI" href="KSM.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> uWSGI
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="WSGIquickstart.html">Quickstart for Python/WSGI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="PSGIquickstart.html">Quickstart for perl/PSGI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="RackQuickstart.html">Quickstart for ruby/Rack applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="Snippets.html">Snippets</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Download.html">Getting uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Installing uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildSystem.html">The uWSGI build system</a></li>
<li class="toctree-l1"><a class="reference internal" href="Management.html">Managing the uWSGI server</a></li>
<li class="toctree-l1"><a class="reference internal" href="LanguagesAndPlatforms.html">Supported languages and platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="SupportedPlatforms.html">Supported Platforms/Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebServers.html">Web server integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThingsToKnow.html">Things to know (best practices and &quot;issues&quot;) READ IT !!!</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">Configuring uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="FallbackConfig.html">Fallback configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConfigLogic.html">Configuration logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="Options.html">uWSGI Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="CustomOptions.html">Defining new options for your instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="ParsingOrder.html">How uWSGI parses config files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Vars.html">uwsgi protocol magic variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="Protocol.html">The uwsgi Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="AttachingDaemons.html">Managing external daemons/services</a></li>
<li class="toctree-l1"><a class="reference internal" href="MasterFIFO.html">The Master FIFO</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inetd.html">Socket activation with inetd/xinetd</a></li>
<li class="toctree-l1"><a class="reference internal" href="Upstart.html">Running uWSGI via Upstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="Systemd.html">Systemd</a></li>
<li class="toctree-l1"><a class="reference internal" href="Circus.html">Running uWSGI instances with Circus</a></li>
<li class="toctree-l1"><a class="reference internal" href="Embed.html">Embedding an application in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogFormat.html">Formatting uWSGI requests logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogEncoders.html">Log encoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hooks.html">Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="WorkerOverride.html">Overriding Workers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="ThirdPartyPlugins.html">uWSGI third party plugins</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/CachingCookbook.html">The uWSGI Caching Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/Django_and_nginx.html">Setting up Django and your web server with uWSGI and nginx</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/dreamhost.html">Running uWSGI on Dreamhost shared hosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/heroku_python.html">Running python webapps on Heroku with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/heroku_ruby.html">Running Ruby/Rack webapps on Heroku with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/ReliableFuse.html">Reliably use FUSE filesystems for uWSGI vassals (with Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/DynamicProxying.html">Build a dynamic proxy using RPC and internal routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/GraphiteAndMetrics.html">Setting up Graphite on Ubuntu using the Metrics subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="articles/SerializingAccept.html">Serializing accept(), AKA Thundering Herd, AKA the Zeeg Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/TheArtOfGracefulReloading.html">The Art of Graceful Reloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/FunWithPerlEyetoyRaspberrypi.html">Fun with Perl, Eyetoy and RaspberryPi</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/OffloadingWebsocketsAndSSE.html">Offloading Websockets and Server-Sent Events AKA &quot;Combine them with Django safely&quot;</a></li>
<li class="toctree-l1"><a class="reference internal" href="articles/WSGIEnvBehaviour.html">WSGI env behaviour policies</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AlarmSubsystem.html">The uWSGI alarm subsystem (from 1.3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Caching.html">The uWSGI caching framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebCaching.html">WebCaching framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cron.html">The uWSGI cron-like interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fastrouter.html">The uWSGI FastRouter</a></li>
<li class="toctree-l1"><a class="reference internal" href="InternalRouting.html">uWSGI internal routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Legion.html">The uWSGI Legion subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Locks.html">Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mules.html">uWSGI Mules</a></li>
<li class="toctree-l1"><a class="reference internal" href="OffloadSubsystem.html">The uWSGI offloading subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Queue.html">The uWSGI queue framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="RPC.html">uWSGI RPC Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="SharedArea.html">SharedArea -- share memory pages between uWSGI components</a></li>
<li class="toctree-l1"><a class="reference internal" href="Signals.html">The uWSGI Signal Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Spooler.html">The uWSGI Spooler</a></li>
<li class="toctree-l1"><a class="reference internal" href="SubscriptionServer.html">uWSGI Subscription Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="StaticFiles.html">Serving static files with uWSGI (updated to 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="SNI.html">SNI - Server Name Identification (virtual hosting for SSL nodes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeoIP.html">The GeoIP plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Transformations.html">uWSGI Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebSockets.html">WebSocket support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metrics.html">The Metrics subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chunked.html">The Chunked input API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cheaper.html">The uWSGI cheaper subsystem -- adaptive process spawning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emperor.html">The uWSGI Emperor -- multi-app deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="Broodlord.html">Auto-scaling with Broodlord mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="Zerg.html">Zerg mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicApps.html">Adding applications dynamically</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSLScaling.html">Scaling SSL connections (uWSGI 1.9)</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Capabilities.html">Setting POSIX Capabilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cgroups.html">Running uWSGI in a Linux CGroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="KSM.html">Using Linux KSM in uWSGI</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Jailing your apps using Linux Namespaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-are-namespaces">What are namespaces?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clone-vs-unshare">clone() vs unshare()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-namespaces">Supported namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setns">setns()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pivot-root">pivot_root</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-not-lxc">Why not lxc?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#the-old-way-the-namespace-option">The old way: the --namespace option</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#reloading-uwsgi">Reloading uWSGI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-secure-is-this-sort-of-jailing">How secure is this sort of jailing?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-filesystems">Additional filesystems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FreeBSDJails.html">FreeBSD Jails</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkptyRouter.html">The Forkpty Router</a></li>
<li class="toctree-l1"><a class="reference internal" href="TunTapRouter.html">The TunTap Router</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Nagios.html">Monitoring uWSGI with Nagios</a></li>
<li class="toctree-l1"><a class="reference internal" href="SNMP.html">The embedded SNMP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="PushingStats.html">Pushing statistics (from 1.4)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Carbon.html">Integration with Graphite/Carbon</a></li>
<li class="toctree-l1"><a class="reference internal" href="StatsServer.html">The uWSGI Stats Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metrics.html">The Metrics subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Async.html">uWSGI asynchronous/non-blocking modes (updated to uWSGI 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Gevent.html">The Gevent loop engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tornado.html">The Tornado loop engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="uGreen.html">uGreen -- uWSGI Green Threads</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio.html">The asyncio loop engine (CPython &gt;= 3.4, uWSGI &gt;= 2.0.4)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Apache.html">Apache support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cherokee.html">Cherokee support</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTTP.html">Native HTTP support</a></li>
<li class="toctree-l1"><a class="reference internal" href="HTTPS.html">HTTPS 지원 (1.3 버전부터)</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPDY.html">The SPDY router (uWSGI 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lighttpd.html">Lighttpd support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mongrel2.html">Attaching uWSGI to Mongrel2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Nginx.html">Nginx support</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenBSDhttpd.html">Using OpenBSD httpd as proxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="OpenBSDhttpd.html#notes">Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Python.html">Python support</a></li>
<li class="toctree-l1"><a class="reference internal" href="PyPy.html">The PyPy plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="PHP.html">Running PHP scripts in uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Perl.html">uWSGI Perl support (PSGI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ruby.html">Ruby support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lua.html">Using Lua/WSAPI with uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="JVM.html">JVM in the uWSGI server (updated to 1.9)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mono.html">The Mono ASP.NET plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="CGI.html">Running CGI scripts on uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="GCCGO.html">The GCCGO plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Symcall.html">The Symcall plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="XSLT.html">The XSLT plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="SSI.html">SSI (Server Side Includes) plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="V8.html">uWSGI V8 support</a></li>
<li class="toctree-l1"><a class="reference internal" href="GridFS.html">The GridFS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="GlusterFS.html">The GlusterFS plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Rados.html">The RADOS plugin</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Pty.html">The Pty plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPNEGO.html">SPNEGO authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="LDAP.html">Configuring uWSGI with LDAP</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Erlang.html">Integrating uWSGI with Erlang</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagementFlag.html">Management Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="Go.html">uWSGI Go support (1.4 only)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.18.html">uWSGI 2.0.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.17.1.html">uWSGI 2.0.17.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.17.html">uWSGI 2.0.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.16.html">uWSGI 2.0.16</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.15.html">uWSGI 2.0.15</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.14.html">uWSGI 2.0.14</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.13.1.html">uWSGI 2.0.13.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.13.html">uWSGI 2.0.13</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.12.html">uWSGI 2.0.12</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.2.html">uWSGI 2.0.11.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.1.html">uWSGI 2.0.11.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.11.html">uWSGI 2.0.11</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.10.html">uWSGI 2.0.10</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.9.html">uWSGI 2.0.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.8.html">uWSGI 2.0.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.7.html">uWSGI 2.0.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.6.html">uWSGI 2.0.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.5.html">uWSGI 2.0.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.4.html">uWSGI 2.0.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.3.html">uWSGI 2.0.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.2.html">uWSGI 2.0.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.1.html">uWSGI 2.0.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-2.0.html">uWSGI 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.21.html">uWSGI 1.9.21</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.20.html">uWSGI 1.9.20</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.19.html">uWSGI 1.9.19</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.18.html">uWSGI 1.9.18</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.17.html">uWSGI 1.9.17</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.16.html">uWSGI 1.9.16</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.15.html">uWSGI 1.9.15</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.14.html">uWSGI 1.9.14</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.13.html">uWSGI 1.9.13</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.12.html">uWSGI 1.9.12</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.11.html">uWSGI 1.9.11</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.10.html">uWSGI 1.9.10</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.9.html">uWSGI 1.9.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.8.html">uWSGI 1.9.8</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.7.html">uWSGI 1.9.7</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.6.html">uWSGI 1.9.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.5.html">uWSGI 1.9.5</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.4.html">uWSGI 1.9.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.3.html">uWSGI 1.9.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.2.html">uWSGI 1.9.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.1.html">uWSGI 1.9.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog-1.9.html">uWSGI 1.9</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">uWSGI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Jailing your apps using Linux Namespaces</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Namespaces.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="jailing-your-apps-using-linux-namespaces">
<h1>Jailing your apps using Linux Namespaces<a class="headerlink" href="#jailing-your-apps-using-linux-namespaces" title="제목 주소">¶</a></h1>
<p>If you have a recent Linux kernel (&gt;2.6.26) and you are not on the Itanium architecture you can use the namespaces support.</p>
<div class="section" id="what-are-namespaces">
<h2>What are namespaces?<a class="headerlink" href="#what-are-namespaces" title="제목 주소">¶</a></h2>
<p>They are an elegant (more elegant than most of the jailing systems you might find in other operating systems) way to &quot;detach&quot; your processes from a specific layer of the kernel and assign them to a new one.</p>
<p>The 'chroot' system available on UNIX/Posix systems is a primal form of namespaces: a process sees a completely new file system root and has no access to the original one.</p>
<p>Linux extends this concept to the other OS layers (PIDs, users, IPC, networking etc.), so a specific process can live in a &quot;virtual OS&quot; with a new group of pids, a new set of users, a completely unshared IPC system (semaphores, shared memory etc.), a dedicated network interface and its own hostname.</p>
<p>uWSGI got full namespaces support in 1.9/2.0 development cycle.</p>
</div>
<div class="section" id="clone-vs-unshare">
<h2>clone() vs unshare()<a class="headerlink" href="#clone-vs-unshare" title="제목 주소">¶</a></h2>
<p>To place the current process in a new namespace you have two syscalls: the venerable <code class="docutils literal notranslate"><span class="pre">clone()</span></code>, that will create a new process in the specified namespace
and the new kid on the block, <code class="docutils literal notranslate"><span class="pre">unshare()</span></code>, that changes namespaces for the current running process.</p>
<p><code class="docutils literal notranslate"><span class="pre">clone()</span></code> can be used by the Emperor to directly spawn vassals in new namespaces:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">emperor</span> <span class="o">=</span> <span class="s">/etc/uwsgi/vassals</span>
<span class="na">emperor-use-clone</span> <span class="o">=</span> <span class="s">fs,net,ipc,uts,pid</span>
</pre></div>
</div>
<p>will run each vassal with a dedicated filesystem, networking, SysV IPC and UTS view.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">unshare</span> <span class="o">=</span> <span class="s">ipc,uts</span>
<span class="na">...</span>
</pre></div>
</div>
<p>will run the current instance in the specified namespaces.</p>
<p>Some namespace subsystems require additional steps for sane usage (see below).</p>
</div>
<div class="section" id="supported-namespaces">
<h2>Supported namespaces<a class="headerlink" href="#supported-namespaces" title="제목 주소">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">fs</span></code> -&gt; CLONE_NEWNS, filesystems</li>
<li><code class="docutils literal notranslate"><span class="pre">ipc</span></code> -&gt; CLONE_NEWIPC, sysv ipc</li>
<li><code class="docutils literal notranslate"><span class="pre">pid</span></code> -&gt; CLONE_NEWPID, when used with unshare() requires an additional <code class="docutils literal notranslate"><span class="pre">fork()</span></code>. Use one of the --refork-* options.</li>
<li><code class="docutils literal notranslate"><span class="pre">uts</span></code> -&gt; CLONE_NEWUTS, hostname</li>
<li><code class="docutils literal notranslate"><span class="pre">net</span></code> -&gt; CLONE_NEWNET, new networking, UNIX sockets from different namespaces are still usable, they are a good way for inter-namespaces communications</li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code> -&gt; CLONE_NEWUSER, still complex to manage (and has differences in behaviours between kernel versions) use with caution</li>
</ul>
</div>
<div class="section" id="setns">
<h2>setns()<a class="headerlink" href="#setns" title="제목 주소">¶</a></h2>
<p>In addition to creating new namespaces for a process you can attach to already running ones using the <code class="docutils literal notranslate"><span class="pre">setns()</span></code> call.</p>
<p>Each process exposes its namespaces via the <code class="docutils literal notranslate"><span class="pre">/proc/self/ns</span></code> directory. The setns() syscall uses the file descriptors obtained from the files in that directory
to attach to namespaces.</p>
<p>As we have already seen, UNIX sockets are a good way to communicate between namespaces, the uWSGI <code class="docutils literal notranslate"><span class="pre">setns()</span></code> feature works by creating an UNIX socket that receives requests
from processes wanting to join its namespace. As UNIX sockets allow file descriptors passing, the &quot;client&quot; only need to call setns() on them.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">setns-socket</span> <span class="pre">&lt;addr&gt;</span></code> exposes /proc/self/ns on the specified unix socket address</li>
<li><code class="docutils literal notranslate"><span class="pre">setns</span> <span class="pre">&lt;addr&gt;</span></code> connect to the specified unix socket address, get the filedescriptors and use setns() on them</li>
<li><code class="docutils literal notranslate"><span class="pre">setns-preopen</span></code> if enabled the /proc/self/ns files are opened on startup (before privileges drop) and cached. This is useful for avoiding running the main instance as root.</li>
<li><code class="docutils literal notranslate"><span class="pre">setns-socket-skip</span> <span class="pre">&lt;name&gt;</span></code> some file in /proc/self/ns can create problems (mostly the 'user' one). You can skip them specifying the name. (you can specify this option multiple times)</li>
</ul>
</div>
<div class="section" id="pivot-root">
<h2>pivot_root<a class="headerlink" href="#pivot-root" title="제목 주소">¶</a></h2>
<p>This option allows you to change the rootfs of your currently running instance.</p>
<p>It is better than chroot as it allows you to access the old file system tree before (manually) unmounting it.</p>
<p>It is a bit complex to master correctly as it requires a couple of assumptions:</p>
<p><code class="docutils literal notranslate"><span class="pre">pivot_root</span> <span class="pre">&lt;new&gt;</span> <span class="pre">&lt;old&gt;</span></code></p>
<p>&lt;new&gt; is the directory to mount as the new rootfs and &lt;old&gt; is where to access the old tree.</p>
<p>&lt;new&gt; must be a mounted file system, and &lt;old&gt; must be under this file system.</p>
<p>A common pattern is:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">unshare</span> <span class="o">=</span> <span class="s">fs</span>
<span class="na">hook-post-jail</span> <span class="o">=</span> <span class="s">mount:none /distros/precise /ns bind</span>
<span class="na">pivot_root</span> <span class="o">=</span> <span class="s">/ns /ns/.old_root</span>
<span class="na">...</span>
</pre></div>
</div>
<p>(Remember to create <code class="docutils literal notranslate"><span class="pre">/ns</span></code> and <code class="docutils literal notranslate"><span class="pre">/distro/precise/.old_root</span></code>.)</p>
<p>When you have created the new file system layout you can umount /.old_root recursively:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[uwsgi]</span>
<span class="na">unshare</span> <span class="o">=</span> <span class="s">fs</span>
<span class="na">hook-post-jail</span> <span class="o">=</span> <span class="s">mount:none /distros/precise /ns bind</span>
<span class="na">pivot_root</span> <span class="o">=</span> <span class="s">/ns /ns/.old_root</span>
<span class="c1">; bind mount some useful fs like /dev and /proc</span>
<span class="na">hook-as-root</span> <span class="o">=</span> <span class="s">mount:proc none /proc nodev hidepid=2</span>
<span class="na">hook-as-root</span> <span class="o">=</span> <span class="s">mount:none /.old_root/dev /dev bind</span>
<span class="na">hook-as-root</span> <span class="o">=</span> <span class="s">mount:none /.old_root/dev/pts /dev/pts bind</span>
<span class="c1">; umount the old tree</span>
<span class="na">hook-as-root</span> <span class="o">=</span> <span class="s">umount:/.old_root rec,detach</span>
</pre></div>
</div>
</div>
<div class="section" id="why-not-lxc">
<h2>Why not lxc?<a class="headerlink" href="#why-not-lxc" title="제목 주소">¶</a></h2>
<p>LXC (LinuX Containers) is a project allowing you to build full subsystems using Linux namespaces. You may ask why &quot;reinvent the wheel&quot; while LXC implements
a fully &quot;virtualized&quot; system. Apples and oranges...</p>
<p>LXC's objective is giving users the view of a virtual server. uWSGI namespaces support is lower level -- you can use it to detach
single components (for example you may only want to unshare IPC) to increase security and isolation.</p>
<p>Not all the scenario requires a full system-like view (and in lot of case is suboptimal, while in other is the best approach), try to
see namespaces as a way to increase security and isolation, when you need/can isolate a component do it with clone/unshare. When you want
to give users a full system-like access go with LXC.</p>
</div>
</div>
<div class="section" id="the-old-way-the-namespace-option">
<h1>The old way: the --namespace option<a class="headerlink" href="#the-old-way-the-namespace-option" title="제목 주소">¶</a></h1>
<p>Before 1.9/2.0 a full featured system-like namespace support was added. It works as a chroot() on steroids.</p>
<p>It should be moved as an external plugin pretty soon, but will be always part of the main distribution, as it is used by lot of people
for its simplicity.</p>
<p>You basically need to set a root filesystem and an hostname to start your instance in a new namespace:</p>
<p>Let's start by creating a new root filesystem for our jail. You'll need <code class="docutils literal notranslate"><span class="pre">debootstrap</span></code> (or an equivalent package for your distribution).
We're placing our rootfs in <code class="docutils literal notranslate"><span class="pre">/ns/001</span></code>, and then create a 'uwsgi' user that will run the uWSGI server.
We will use the chroot command to 'adduser' in the new rootfs, and we will install the Flask package, required by uwsgicc.</p>
<p>(All this needs to be executed as root)</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mkdir -p /ns/001
debootstrap maverick /ns/001
chroot /ns/001
<span class="c1"># in the chroot jail now</span>
adduser uwsgi
apt-get install mercurial python-flask
su - uwsgi
<span class="c1"># as uwsgi now</span>
git clone https://github.com/unbit/uwsgicc.git .
<span class="nb">exit</span> <span class="c1"># out of su - uwsgi</span>
<span class="nb">exit</span> <span class="c1"># out of the jail</span>
</pre></div>
</div>
<p>Now on your real system run</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>uwsgi --socket <span class="m">127</span>.0.0.1:3031 --chdir /home/uwsgi/uwsgi --uid uwsgi --gid uwsgi --module uwsgicc --master --processes <span class="m">4</span> --namespace /ns/001:mybeautifulhostname
</pre></div>
</div>
<p>If all goes well, uWSGI will set <code class="docutils literal notranslate"><span class="pre">/ns/001</span></code> as the new root filesystem, assign <code class="docutils literal notranslate"><span class="pre">mybeautifulhostname</span></code> as the hostname and hide the PIDs and IPC of the host system.</p>
<p>The first thing you should note is the uWSGI master becoming PID 1 (the &quot;init&quot; process) in the new namespace.
All processes generated by the uWSGI stack will be reparented to it if something goes wrong. If the master dies, all jailed processes die.</p>
<p>Now point your web browser to your web server and you should see the uWSGI Control Center interface.</p>
<p>Pay attention to the information area. The node name (used by cluster subsystem) matches the real hostname as it does not make sense to have multiple jail in the same cluster group. In the hostname field instead you will see the hostname you have set.</p>
<p>Another important thing is that you can see all the jail processes from your real system (they will have a different set of PIDs), so if you want to take control of the jail
you can easily do it.</p>
<div class="admonition note">
<p class="first admonition-title">주석</p>
<p>A good way to limit hardware usage of jails is to combine them with the cgroups subsystem.</p>
<div class="last admonition seealso">
<p class="first admonition-title">더 보기</p>
<p class="last"><a class="reference internal" href="Cgroups.html"><span class="doc">Running uWSGI in a Linux CGroup</span></a></p>
</div>
</div>
<div class="section" id="reloading-uwsgi">
<h2>Reloading uWSGI<a class="headerlink" href="#reloading-uwsgi" title="제목 주소">¶</a></h2>
<p>When running in a jail, uWSGI uses another system for reloading: it'll simply tell workers to bugger off and then exit. The parent process living outside the namespace will see this and respawn the stack in a new jail.</p>
</div>
<div class="section" id="how-secure-is-this-sort-of-jailing">
<h2>How secure is this sort of jailing?<a class="headerlink" href="#how-secure-is-this-sort-of-jailing" title="제목 주소">¶</a></h2>
<p>Hard to say! All software tends to be secure until a hole is found.</p>
</div>
<div class="section" id="additional-filesystems">
<h2>Additional filesystems<a class="headerlink" href="#additional-filesystems" title="제목 주소">¶</a></h2>
<p>When app is jailed to namespace it only has access to its virtual jail root filesystem. If there is any other filesystem mounted inside the jail directory, it won't be accessible, unless you use <code class="docutils literal notranslate"><span class="pre">namespace-keep-mount</span></code>.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># app1 jail is located here</span>
<span class="na">namespace</span> <span class="o">=</span> <span class="s">/apps/app1</span>

<span class="c1"># nfs share mounted on the host side</span>
<span class="na">namespace-keep-mount</span> <span class="o">=</span> <span class="s">/apps/app1/nfs</span>
</pre></div>
</div>
<p>This will bind /apps/app1/nfs to jail, so that jailed app can access it under /nfs directory</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># app1 jail is located here</span>
<span class="na">namespace</span> <span class="o">=</span> <span class="s">/apps/app1</span>

<span class="c1"># nfs share mounted on the host side</span>
<span class="na">namespace-keep-mount</span> <span class="o">=</span> <span class="s">/mnt/nfs1:/nfs</span>
</pre></div>
</div>
<p>If the filesystem that we want to bind is mounted in path not contained inside our jail, than we can use &quot;&lt;source&gt;:&lt;dest&gt;&quot; syntax for --namespace-keep-mount. In this case the /mnt/nfs1 will be binded to /nfs directory inside the jail.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="FreeBSDJails.html" class="btn btn-neutral float-right" title="FreeBSD Jails" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="KSM.html" class="btn btn-neutral" title="Using Linux KSM in uWSGI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012-2016, uWSGI.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.0',
            LANGUAGE:'ko',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>